目标：用“连续四个相同数字”作为彩蛋触发条件，替代原 2026/6666/8888 检测；达到 ≥10000 立即结束并播放全屏新年动画；保证高性能与跨分辨率适配。

## 一、涉及文件
- 核心逻辑：[js/game.js](file:///c:/Users/ASUS/Documents/trae_projects/newyeargame/js/game.js)（update、UI触发、结束态）
- 样式与动画层：[css/style.css](file:///c:/Users/ASUS/Documents/trae_projects/newyeargame/css/style.css)
- 入口/叠加层结构：[index.html](file:///c:/Users/ASUS/Documents/trae_projects/newyeargame/index.html)

## 二、算法与触发改造
- 去除固定分数点判定（2026/6666/8888）。在 update() 中于“分数更新时”执行一次检测：
  - 将当前分数取整为字符串 s，例如 "6344"；使用高效模式匹配 `/(\d)\1{3}/` 检测是否出现连续四个相同数字（1111–9999）。
  - 若命中，提取该数字 d（1–9）作为彩蛋键并去重触发（用 `this.secrets[d]` 或 `this.lastEggDigit` 防重复）。
- 分数上限：当 `this.score >= 10000` 时：
  - 立即切换到 `win` 或 `final` 状态；停止玩家更新；调用全屏动画入口；提供“返回主菜单/重新开始”。

## 三、成语祝福映射
- 在 game.js 中定义映射：
  - 1111→一马当先；2222→二龙腾飞；3333→三阳开泰；4444→四季平安；5555→五福临门；6666→六六大顺；7777→七星高照；8888→八方来财；9999→九九同心。
- 触发后：
  - 在显著位置（屏幕中央或顶部横幅）显示对应成语，字体使用衬线体并加发光效果（css: neon/glow）。
  - 播放对应音效（鼓点/锣声/庆祝音），通过 AudioController 增加一个短促的喜庆音色包。

## 四、全屏新春动画实现
- 结构：在 index.html 增加一个 `#newyear-overlay` 全屏层，默认 `hidden`；
- 内容：
  - 动态祝福主标题（“新年快乐”“恭喜发财”随机轮播或根据触发数字选择）。
  - 复用/扩展现有 Firework 粒子，叠加灯笼漂浮、金粉飘落（雪层改为金粉），持续≥3秒。
  - 结束时淡出过渡并展示按钮：“返回主菜单”“再来一次”。
- 适配：
  - 使用 vw/vh 与 flex 居中；
  - 字号随 viewport 缩放；
  - 粒子数量与 DPR 关联，低端设备自动降级（已有自适应逻辑可复用）。

## 五、性能与工程规范
- 检测频率优化：仅在 `Math.floor(score)` 发生变化时做一次正则检测，避免每帧字符串分配。
- 去重与节流：同一数字仅首次触发；若短时间内连续命中不同数字，用 1–2 秒节流避免覆盖 UI。
- 音效：通过已有 AudioController 增加 `playCelebration(d)`，可选用 triangle/sine 搭配短包络及少量噪声模拟锣鼓。

## 六、测试用例
- 单元/集成思路：
  - 构造分数序列：1109→1110→1111（应触发“一马当先”）；2220→2222；...→9999（逐一验证）。
  - 边界：10999→10000（应结束且播放全屏动画）。
  - 负例：1121/1211（不触发）。
- 设备与性能：
  - iOS Safari、Android Chrome、微信内置浏览器；
  - 低端设备验证动画掉帧时自动降级（减少粒子、降低 DPR）。

## 七、实施步骤
1. 重构 update()：移除旧彩蛋点，加入“连续四位相同数字”检测与上限逻辑。
2. 新增祝福显示函数：`showIdiomBanner(d)` 负责文案、样式与计时淡出。
3. 新增全屏动画层与控制：`startNewYearOverlay()` 播放≥3秒动画并给出返回/重开选项。
4. 扩展 AudioController：添加 `playCelebration(d)` 音效。
5. 编写测试脚本或调试入口：快速注入分数并观察 UI/动画与结束逻辑。

## 八、交付
- 更新后的 game.js、style.css、index.html；
- 测试记录与问题清单；
- 可选：在 README/指南中新增“彩蛋与祝福系统”章节说明。